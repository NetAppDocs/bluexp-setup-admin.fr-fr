= 
:allow-uri-read: 


. Assurez-vous que vous disposez des autorisations dans Azure pour créer une application Active Directory et attribuer l'application à un rôle.
+
Pour plus de détails, reportez-vous à https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#required-permissions/["Documentation Microsoft Azure : autorisations requises"^]

. À partir du portail Azure, ouvrez le service *Azure Active Directory*.
+
image:screenshot_azure_ad.gif["Affiche le service Active Directory dans Microsoft Azure."]

. Dans le menu, cliquez sur *enregistrements d'applications*.
. Cliquez sur *Nouvelle inscription*.
. Spécifiez les détails de l'application :
+
** *Nom* : saisissez un nom pour l'application.
** *Type de compte* : sélectionnez un type de compte (tout fonctionne avec BlueXP).
** *URI de redirection*: Vous pouvez laisser ce champ vide.


. Cliquez sur *Enregistrer*.
+
Vous avez créé l'application AD et le principal de service.



. Création d'un rôle personnalisé :
+
Notez que vous pouvez créer un rôle personnalisé Azure à l'aide du portail Azure, d'Azure PowerShell, de l'interface de ligne de commandes Azure ou de l'API REST. La procédure suivante explique comment créer le rôle à l'aide de l'interface de ligne de commandes Azure. Si vous préférez utiliser une autre méthode, reportez-vous à la section https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles#steps-to-create-a-custom-role["Documentation Azure"^]

+
.. Copier le contenu du link:reference-permissions-azure.html["Autorisations de rôle personnalisées pour le connecteur"] Et les enregistrer dans un fichier JSON.
.. Modifiez le fichier JSON en ajoutant des identifiants d'abonnement Azure à l'étendue assignable.
+
Vous devez ajouter l'ID de chaque abonnement Azure à partir duquel les utilisateurs créeront des systèmes Cloud Volumes ONTAP.

+
*Exemple*

+
[source, json]
----
"AssignableScopes": [
"/subscriptions/d333af45-0d07-4154-943d-c25fbzzzzzzz",
"/subscriptions/54b91999-b3e6-4599-908e-416e0zzzzzzz",
"/subscriptions/398e471c-3b42-4ae7-9b59-ce5bbzzzzzzz"
----
.. Utilisez le fichier JSON pour créer un rôle personnalisé dans Azure.
+
Les étapes suivantes expliquent comment créer le rôle à l'aide de Bash dans Azure Cloud Shell.

+
*** Démarrer https://docs.microsoft.com/en-us/azure/cloud-shell/overview["Shell cloud Azure"^] Et choisissez l'environnement Bash.
*** Téléchargez le fichier JSON.
+
image:screenshot_azure_shell_upload.png["Capture d'écran d'Azure Cloud Shell sur laquelle vous pouvez choisir de charger un fichier."]

*** Pour créer le rôle personnalisé, utilisez l'interface de ligne de commandes Azure :
+
[source, azurecli]
----
az role definition create --role-definition Connector_Policy.json
----
+
Vous devez maintenant avoir un rôle personnalisé appelé opérateur BlueXP que vous pouvez affecter à la machine virtuelle connecteur.





. Attribuez l'application au rôle :
+
.. À partir du portail Azure, ouvrez le service *abonnements*.
.. Sélectionnez l'abonnement.
.. Cliquez sur *contrôle d'accès (IAM) > Ajouter > Ajouter une affectation de rôle*.
.. Dans l'onglet *role*, sélectionnez le rôle *BlueXP Operator* et cliquez sur *Next*.
.. Dans l'onglet *membres*, procédez comme suit :
+
*** Conserver *utilisateur, groupe ou entité de service* sélectionnée.
*** Cliquez sur *Sélectionner les membres*.
+
image:screenshot-azure-service-principal-role.png["Capture d'écran du portail Azure affichant l'onglet membres lors de l'ajout d'un rôle à une application."]

*** Recherchez le nom de l'application.
+
Voici un exemple :

+
image:screenshot_azure_service_principal_role.png["Une capture d'écran du portail Azure affichant le formulaire d'affectation de rôle Add dans le portail Azure."]

*** Sélectionnez l'application et cliquez sur *Sélectionner*.
*** Cliquez sur *Suivant*.


.. Cliquez sur *Revue + affecter*.
+
Le principal de service dispose désormais des autorisations Azure nécessaires pour déployer le connecteur.

+
Si vous souhaitez déployer Cloud Volumes ONTAP à partir de plusieurs abonnements Azure, vous devez lier le principal de service à chacun de ces abonnements. BlueXP vous permet de sélectionner l'abonnement que vous souhaitez utiliser lors du déploiement de Cloud Volumes ONTAP.





. Dans le service *Azure Active Directory*, cliquez sur *App inscriptions* et sélectionnez l'application.
. Cliquez sur *autorisations API > Ajouter une autorisation*.
. Sous *Microsoft API*, sélectionnez *Azure Service Management*.
+
image:screenshot_azure_service_mgmt_apis.gif["Capture d'écran du portail Azure affichant les autorisations de l'API de gestion de services Azure."]

. Cliquez sur *Access Azure Service Management en tant qu'utilisateurs d'organisation*, puis sur *Add permissions*.
+
image:screenshot_azure_service_mgmt_apis_add.gif["Une capture d'écran du portail Azure montrant l'ajout des API de gestion de services Azure."]



. Dans le service *Azure Active Directory*, cliquez sur *App inscriptions* et sélectionnez l'application.
. Copiez l'ID *application (client)* et l'ID *Directory (tenant)*.
+
image:screenshot_azure_app_ids.gif["Capture d'écran affichant l'ID de l'application (client) et l'ID du répertoire (tenant) d'une application dans Azure Active Directory."]

+
Lorsque vous ajoutez le compte Azure à BlueXP, vous devez fournir l'ID d'application (client) et l'ID de répertoire (tenant) de l'application. BlueXP utilise les ID pour se connecter par programmation.



. Ouvrez le service *Azure Active Directory*.
. Cliquez sur *App Inregistrations* et sélectionnez votre application.
. Cliquez sur *certificats et secrets > Nouveau secret client*.
. Fournissez une description du secret et une durée.
. Cliquez sur *Ajouter*.
. Copier la valeur du secret client.
+
image:screenshot_azure_client_secret.gif["Copie d'écran du portail Azure présentant un secret client pour la principale du service Azure AD."]

+
Vous disposez désormais d'un code client que BlueXP peut utiliser pour vous authentifier auprès d'Azure AD.


