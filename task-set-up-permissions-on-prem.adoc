---
sidebar: sidebar 
permalink: task-set-up-permissions-on-prem.html 
keywords: set up permissions, cloud permissions, aws permissions, azure permissions, on prem permissions, connector permissions 
summary: 'Si vous souhaitez utiliser les services BlueXP dans AWS ou Azure avec un connecteur sur site, vous devez configurer des autorisations dans votre fournisseur cloud afin de pouvoir ajouter les informations d"identification au connecteur une fois que vous l"avez installé.' 
---
= Configurez les autorisations cloud pour les déploiements sur site
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Si vous souhaitez utiliser les services BlueXP dans AWS ou Azure avec un connecteur sur site, vous devez configurer des autorisations dans votre fournisseur cloud afin de pouvoir ajouter les informations d'identification au connecteur une fois que vous l'avez installé.


TIP: Pourquoi ne pas Google Cloud ? Une fois le connecteur installé sur votre site, il ne peut pas gérer vos ressources dans Google Cloud. Le connecteur doit être installé dans Google Cloud pour gérer toutes les ressources qui y résident.

[role="tabbed-block"]
====
.AWS
--
Lorsque le connecteur est installé sur site, vous devez fournir BlueXP avec des autorisations AWS en ajoutant des clés d'accès à un utilisateur IAM qui dispose des autorisations requises.

Vous devez utiliser cette méthode d'authentification si le connecteur est installé sur site. Vous ne pouvez pas utiliser de rôle IAM.

.Étapes
. Connectez-vous à la console AWS et accédez au service IAM.
. Création d'une règle :
+
.. Sélectionnez *stratégies > Créer une stratégie*.
.. Sélectionnez *JSON* et copiez et collez le contenu du link:reference-permissions-aws.html["Politique IAM pour le connecteur"].
.. Terminez les étapes restantes pour créer la stratégie.
+
Selon les services BlueXP que vous prévoyez d'utiliser, il peut être nécessaire de créer une seconde règle.

+
Pour les régions standard, les autorisations sont réparties entre deux règles. Deux règles sont requises en raison d'une taille maximale de caractères pour les stratégies gérées dans AWS. link:reference-permissions-aws.html["En savoir plus sur les règles IAM pour le connecteur"].



. Associer les règles à un utilisateur IAM.
+
** https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create.html["Documentation AWS : création de rôles IAM"^]
** https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage-attach-detach.html["Documentation AWS : ajout et suppression de règles IAM"^]


. Assurez-vous que l'utilisateur dispose d'une clé d'accès que vous pouvez ajouter à BlueXP après l'installation du connecteur.


.Résultat
Vous devez maintenant disposer des clés d'accès pour un utilisateur IAM qui dispose des autorisations requises. Après avoir installé le connecteur, vous devez associer ces informations d'identification au connecteur de BlueXP.

link:task-provide-permissions-on-prem.html["Découvrez comment fournir ces autorisations à BlueXP"].

--
.Azure
--
Une fois le connecteur installé sur site, vous devez fournir BlueXP avec des autorisations Azure en configurant un principal de service dans Azure Active Directory et en obtenant les identifiants Azure requis par BlueXP.

.Créez une application Azure Active Directory pour le contrôle d'accès basé sur des rôles
. Assurez-vous que vous disposez des autorisations dans Azure pour créer une application Active Directory et attribuer l'application à un rôle.
+
Pour plus de détails, reportez-vous à https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#required-permissions/["Documentation Microsoft Azure : autorisations requises"^]

. À partir du portail Azure, ouvrez le service *Azure Active Directory*.
+
image:screenshot_azure_ad.gif["Affiche le service Active Directory dans Microsoft Azure."]

. Dans le menu, sélectionnez *enregistrements d'applications*.
. Sélectionnez *nouvel enregistrement*.
. Spécifiez les détails de l'application :
+
** *Nom* : saisissez un nom pour l'application.
** *Type de compte* : sélectionnez un type de compte (tout fonctionne avec BlueXP).
** *URI de redirection*: Vous pouvez laisser ce champ vide.


. Sélectionnez *Enregistrer*.
+
Vous avez créé l'application AD et le principal de service.



.Attribuez l'application à un rôle
. Création d'un rôle personnalisé :
+
Notez que vous pouvez créer un rôle personnalisé Azure à l'aide du portail Azure, d'Azure PowerShell, de l'interface de ligne de commandes Azure ou de l'API REST. La procédure suivante explique comment créer le rôle à l'aide de l'interface de ligne de commandes Azure. Si vous préférez utiliser une autre méthode, reportez-vous à la section https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles#steps-to-create-a-custom-role["Documentation Azure"^]

+
.. Copier le contenu du link:reference-permissions-azure.html["Autorisations de rôle personnalisées pour le connecteur"] Et les enregistrer dans un fichier JSON.
.. Modifiez le fichier JSON en ajoutant des identifiants d'abonnement Azure à l'étendue assignable.
+
Vous devez ajouter l'ID de chaque abonnement Azure à partir duquel les utilisateurs créeront des systèmes Cloud Volumes ONTAP.

+
*Exemple*

+
[source, json]
----
"AssignableScopes": [
"/subscriptions/d333af45-0d07-4154-943d-c25fbzzzzzzz",
"/subscriptions/54b91999-b3e6-4599-908e-416e0zzzzzzz",
"/subscriptions/398e471c-3b42-4ae7-9b59-ce5bbzzzzzzz"
----
.. Utilisez le fichier JSON pour créer un rôle personnalisé dans Azure.
+
Les étapes suivantes expliquent comment créer le rôle à l'aide de Bash dans Azure Cloud Shell.

+
*** Démarrer https://docs.microsoft.com/en-us/azure/cloud-shell/overview["Shell cloud Azure"^] Et choisissez l'environnement Bash.
*** Téléchargez le fichier JSON.
+
image:screenshot_azure_shell_upload.png["Capture d'écran d'Azure Cloud Shell sur laquelle vous pouvez choisir de charger un fichier."]

*** Pour créer le rôle personnalisé, utilisez l'interface de ligne de commandes Azure :
+
[source, azurecli]
----
az role definition create --role-definition Connector_Policy.json
----
+
Vous devez maintenant avoir un rôle personnalisé appelé opérateur BlueXP que vous pouvez affecter à la machine virtuelle connecteur.





. Attribuez l'application au rôle :
+
.. À partir du portail Azure, ouvrez le service *abonnements*.
.. Sélectionnez l'abonnement.
.. Sélectionnez *contrôle d'accès (IAM) > Ajouter > Ajouter une affectation de rôle*.
.. Dans l'onglet *role*, sélectionnez le rôle *BlueXP Operator* et sélectionnez *Next*.
.. Dans l'onglet *membres*, procédez comme suit :
+
*** Conserver *utilisateur, groupe ou entité de service* sélectionnée.
*** Sélectionnez *Sélectionner membres*.
+
image:screenshot-azure-service-principal-role.png["Capture d'écran du portail Azure affichant l'onglet membres lors de l'ajout d'un rôle à une application."]

*** Recherchez le nom de l'application.
+
Voici un exemple :

+
image:screenshot_azure_service_principal_role.png["Une capture d'écran du portail Azure affichant le formulaire d'affectation de rôle Add dans le portail Azure."]

*** Sélectionnez l'application et sélectionnez *Sélectionner*.
*** Sélectionnez *Suivant*.


.. Sélectionnez *consulter + affecter*.
+
Le principal de service dispose désormais des autorisations Azure nécessaires pour déployer le connecteur.

+
Si vous souhaitez déployer Cloud Volumes ONTAP à partir de plusieurs abonnements Azure, vous devez lier le principal de service à chacun de ces abonnements. BlueXP vous permet de sélectionner l'abonnement que vous souhaitez utiliser lors du déploiement de Cloud Volumes ONTAP.





.Ajoutez des autorisations d'API de gestion de service Windows Azure
. Dans le service *Azure Active Directory*, sélectionnez *App recalages* et sélectionnez l'application.
. Sélectionnez *autorisations API > Ajouter une autorisation*.
. Sous *Microsoft API*, sélectionnez *Azure Service Management*.
+
image:screenshot_azure_service_mgmt_apis.gif["Capture d'écran du portail Azure affichant les autorisations de l'API de gestion de services Azure."]

. Sélectionnez *accéder à Azure Service Management en tant qu'utilisateurs de l'organisation*, puis sélectionnez *Ajouter des autorisations*.
+
image:screenshot_azure_service_mgmt_apis_add.gif["Une capture d'écran du portail Azure montrant l'ajout des API de gestion de services Azure."]



.Obtenez l'ID d'application et l'ID de répertoire de l'application
. Dans le service *Azure Active Directory*, sélectionnez *App recalages* et sélectionnez l'application.
. Copiez l'ID *application (client)* et l'ID *Directory (tenant)*.
+
image:screenshot_azure_app_ids.gif["Capture d'écran affichant l'ID de l'application (client) et l'ID du répertoire (tenant) d'une application dans Azure Active Directory."]

+
Lorsque vous ajoutez le compte Azure à BlueXP, vous devez fournir l'ID d'application (client) et l'ID de répertoire (tenant) de l'application. BlueXP utilise les ID pour se connecter par programmation.



.Créez un secret client
. Ouvrez le service *Azure Active Directory*.
. Sélectionnez *enregistrements d'applications* et sélectionnez votre application.
. Sélectionnez *certificats et secrets > Nouveau secret client*.
. Fournissez une description du secret et une durée.
. Sélectionnez *Ajouter*.
. Copier la valeur du secret client.
+
image:screenshot_azure_client_secret.gif["Copie d'écran du portail Azure présentant un secret client pour la principale du service Azure AD."]

+
Vous disposez désormais d'un code client que BlueXP peut utiliser pour vous authentifier auprès d'Azure AD.



.Résultat
Votre principal de service est maintenant configuré et vous devez avoir copié l'ID de l'application (client), l'ID du répertoire (tenant) et la valeur du secret client. Après avoir installé le connecteur, vous devez associer ces informations d'identification au connecteur de BlueXP.

link:task-provide-permissions-on-prem.html["Découvrez comment fournir ces autorisations à BlueXP"].

--
====