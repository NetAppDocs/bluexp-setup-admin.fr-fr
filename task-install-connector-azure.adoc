---
sidebar: sidebar 
permalink: task-install-connector-azure.html 
keywords: install connector, azure connector installation, azure connector, install connector in azure, bluexp, azure marketplace, manual install, create connector 
summary: 'Créez un connecteur directement à partir de la console web BlueXP, d"Azure Marketplace ou en installant le logiciel sur votre propre hôte Linux.' 
---
= Créer un connecteur dans Azure
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Créez un connecteur directement à partir de la console web BlueXP, d'Azure Marketplace ou en installant le logiciel sur votre propre hôte Linux.

[role="tabbed-block"]
====
.BlueXP
--
.Avant de commencer
Vous devez disposer des éléments suivants :

* Un abonnement Azure.
* Un vnet et un sous-réseau dans votre région Azure de votre choix.
* Détails sur un serveur proxy, si votre organisation nécessite un proxy pour tout le trafic Internet sortant :
+
** Adresse IP
** Informations d'identification
** Certificat HTTPS


* Une clé publique SSH, si vous souhaitez utiliser cette méthode d'authentification pour la machine virtuelle Connector. L'autre option de la méthode d'authentification est d'utiliser un mot de passe.
+
https://learn.microsoft.com/en-us/azure/virtual-machines/linux-vm-connect?tabs=Linux["Découvrez comment vous connecter à une VM Linux dans Azure"^]

* Si vous ne souhaitez pas que BlueXP crée automatiquement un rôle Azure pour le connecteur, vous devrez créer votre propre rôle link:reference-permissions-azure.html["utilisation de la stratégie sur cette page"].
+
Ces autorisations sont pour l'instance de connecteur elle-même. Il s'agit d'un jeu d'autorisations différent de ce que vous avez configuré précédemment pour déployer simplement le connecteur.



.Étapes
. Si vous créez votre premier environnement de travail, cliquez sur *Ajouter un environnement de travail* et suivez les invites. Sinon, cliquez sur la liste déroulante *Connector* et sélectionnez *Add Connector*.
+
image:screenshot_connector_add.gif["Capture d'écran affichant l'icône du connecteur dans l'en-tête et l'action Ajouter un connecteur."]

. Choisissez *Microsoft Azure* comme fournisseur cloud.
. Sur la page *déploiement d'un connecteur* :
+
.. Sous *Authentication*, sélectionnez l'option d'authentification qui correspond à la façon dont vous configurez les autorisations Azure :
+
*** Sélectionnez *compte utilisateur Azure* pour vous connecter à votre compte Microsoft, qui doit disposer des autorisations requises.
+
Ce formulaire est détenu et hébergé par Microsoft. Vos identifiants ne sont pas fournis à NetApp.

+

TIP: Si vous êtes déjà connecté à un compte Azure, BlueXP utilisera automatiquement ce compte. Si vous avez plusieurs comptes, vous devrez peut-être vous déconnecter d'abord pour vous assurer que vous utilisez le bon compte.

*** Sélectionnez *Active Directory service principal* pour entrer des informations sur le service principal Azure Active Directory qui accorde les autorisations requises :
+
**** ID de l'application (client)
**** ID du répertoire (locataire)
**** Secret client






+
link:task-set-up-permissions-azure.html["Apprenez à obtenir ces valeurs pour un principal de service"].

. Suivez les étapes de l'assistant pour créer le connecteur :
+
** *VM Authentication* : choisissez un abonnement Azure, un emplacement, un nouveau groupe de ressources ou un groupe de ressources existant, puis choisissez une méthode d'authentification pour la machine virtuelle Connector que vous créez.
+
La méthode d'authentification de la machine virtuelle peut être un mot de passe ou une clé publique SSH.

+
https://learn.microsoft.com/en-us/azure/virtual-machines/linux-vm-connect?tabs=Linux["Découvrez comment vous connecter à une VM Linux dans Azure"^]

** *Détails* : saisissez un nom pour l'instance, spécifiez les balises et choisissez si vous souhaitez que BlueXP crée un nouveau rôle avec les autorisations requises ou si vous souhaitez sélectionner un rôle existant avec lequel vous avez configuré link:reference-permissions-azure.html["les autorisations requises"].
+
Notez que vous pouvez choisir les abonnements Azure associés à ce rôle. Chaque abonnement que vous choisissez fournit les autorisations de connecteur pour gérer les ressources de cet abonnement (par exemple, Cloud Volumes ONTAP).

** *Réseau* : choisissez un réseau VNet et un sous-réseau, si vous souhaitez activer une adresse IP publique, et spécifiez éventuellement une configuration proxy.
** *Groupe de sécurité* : choisissez de créer un nouveau groupe de sécurité ou de sélectionner un groupe de sécurité existant qui autorise les règles entrantes et sortantes requises.
+
link:reference-ports-azure.html["Afficher les règles des groupes de sécurité pour Azure"].

** *Review* : consultez vos sélections pour vérifier que votre configuration est correcte.


. Cliquez sur *Ajouter*.
+
La machine virtuelle doit être prête en 7 minutes environ. Vous devez rester sur la page jusqu'à ce que le processus soit terminé.



.Résultat
Une fois le processus terminé, le connecteur est disponible pour être utilisé depuis BlueXP.

--
.Azure Marketplace
--
.Étapes
. Rendez-vous sur la page NetApp Connector VM du Marketplace Azure.
+
https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.netapp-oncommand-cloud-manager["Page Azure Marketplace pour les régions commerciales"^]

. Cliquez sur *l'obtenir maintenant*, puis sur *Continuer*.
. Sur le portail Azure, cliquez sur *Créer* et suivez les étapes de configuration de la machine virtuelle.
+
Noter les éléments suivants lors de la configuration de la machine virtuelle :

+
** *Taille de la VM* : choisissez une taille de VM qui répond aux exigences de CPU et de RAM. Nous recommandons DS3 v2.
** *Disques* : le connecteur peut fonctionner de manière optimale avec des disques durs ou SSD.
** *Groupe de sécurité réseau* : le connecteur nécessite des connexions entrantes utilisant SSH, HTTP et HTTPS.
+
link:reference-ports-azure.html["Afficher les règles des groupes de sécurité pour Azure"].

** *Identité* : sous *gestion*, sélectionnez *Activer l'identité gérée attribuée par le système*.
+
Ce paramètre est important car une identité gérée permet à la machine virtuelle Connector de s'identifier à Azure Active Directory sans fournir d'informations d'identification. https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview["En savoir plus sur les identités gérées pour les ressources Azure"^].



. Dans la page *Revue + créer*, vérifiez vos sélections et cliquez sur *Créer* pour démarrer le déploiement.
+
Azure déploie la machine virtuelle avec les paramètres spécifiés. Le logiciel de la machine virtuelle et du connecteur doit s'exécuter en cinq minutes environ.

. Ouvrez un navigateur Web à partir d'un hôte connecté à la machine virtuelle Connector et entrez l'URL suivante :
+
https://_ipaddress_[]

. Une fois connecté, configurez le connecteur :
+
.. Spécifiez le compte BlueXP à associer au connecteur.
.. Entrez un nom pour le système.
.. Sous *exécutez-vous dans un environnement sécurisé ?* maintenez le mode restreint désactivé.
+
Vous devez désactiver le mode restreint, car ces étapes décrivent l'utilisation de BlueXP en mode standard. Vous devez activer le mode restreint uniquement si vous disposez d'un environnement sécurisé et souhaitez déconnecter ce compte des services back-end BlueXP. Si c'est le cas, link:task-quick-start-restricted-mode.html["Suivez les étapes pour démarrer avec BlueXP en mode restreint"].

.. Cliquez sur *commençons*.




Le connecteur est maintenant installé et configuré avec votre compte BlueXP.

.Et la suite ?
link:task-provide-permissions-azure.html["Fournissez à BlueXP les autorisations que vous avez précédemment configurées"].

--
.Installation manuelle
--
.Avant de commencer
Vous devez disposer des éléments suivants :

* Privilèges root pour installer le connecteur.
* Détails sur un serveur proxy, si un proxy est requis pour accéder à Internet à partir du connecteur.
+
Vous avez la possibilité de configurer un serveur proxy après l'installation, mais cela nécessite de redémarrer le connecteur.

* Un certificat signé par une autorité de certification, si le serveur proxy utilise HTTPS ou si le proxy est un proxy interceptant.
* Identité gérée activée sur la machine virtuelle dans Azure, qui permet de fournir les autorisations Azure requises via un rôle personnalisé.
+
https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/qs-configure-portal-windows-vm["Documentation Microsoft Azure : configurez les identités gérées des ressources Azure sur une machine virtuelle à l'aide du portail Azure"^]



.Description de la tâche
Le programme d'installation disponible sur le site du support NetApp peut être une version antérieure. Après l'installation, le connecteur se met automatiquement à jour si une nouvelle version est disponible.

.Étapes
. Vérifiez que docker est activé et exécuté.
+
[source, cli]
----
sudo systemctl enable docker && sudo systemctl start docker
----
. Si les variables système _http_proxy_ ou _https_proxy_ sont définies sur l'hôte, supprimez-les :
+
[source, cli]
----
unset http_proxy
unset https_proxy
----
+
Si vous ne supprimez pas ces variables système, l'installation échouera.

. Téléchargez le logiciel du connecteur à partir du https://mysupport.netapp.com/site/products/all/details/cloud-manager/downloads-tab["Site de support NetApp"^], Puis copiez-le sur l'hôte Linux.
+
Vous devez télécharger le programme d'installation du connecteur « en ligne » destiné à être utilisé sur votre réseau ou dans le cloud. Un programme d'installation séparé « hors ligne » est disponible pour le connecteur, mais il n'est pris en charge que pour les déploiements en mode privé.

. Attribuez des autorisations pour exécuter le script.
+
[source, cli]
----
chmod +x OnCommandCloudManager-<version>
----
+
Où <version> est la version du connecteur que vous avez téléchargé.

. Exécutez le script d'installation.
+
[source, cli]
----
 ./OnCommandCloudManager-<version> --proxy <HTTP or HTTPS proxy server> --cacert <path and file name of a CA-signed certificate>
----
+
Les paramètres --proxy et --cacert sont facultatifs. Si vous disposez d'un serveur proxy, vous devez entrer le ou les paramètres comme indiqué. Le programme d'installation ne vous invite pas à fournir des informations sur un proxy.

+
Voici un exemple de commande utilisant les deux paramètres facultatifs :

+
[source, cli]
----
 ./OnCommandCloudManager-V3.9.26 --proxy https://user:password@10.0.0.30:8080/ --cacert /tmp/cacert/certificate.cer
----
+
--proxy configure le connecteur pour utiliser un serveur proxy HTTP ou HTTPS à l'aide de l'un des formats suivants :

+
** \http://address:port
** \http://username:password@address:port
** \https://address:port
** \https://username:password@address:port
+
L'utilisateur doit être un utilisateur local. Les utilisateurs du domaine ne sont pas pris en charge.



+
--cacert spécifie un certificat signé par une autorité de certification à utiliser pour l'accès HTTPS entre le connecteur et le serveur proxy. Ce paramètre est requis uniquement si vous spécifiez un serveur proxy HTTPS ou si le proxy est un proxy interceptant.

. Attendez la fin de l'installation.
+
À la fin de l'installation, le service connecteur (ocm) redémarre deux fois si vous avez spécifié un serveur proxy.

. Ouvrez un navigateur Web à partir d'un hôte connecté à la machine virtuelle Connector et entrez l'URL suivante :
+
https://_ipaddress_[]

. Une fois connecté, configurez le connecteur :
+
.. Spécifiez le compte BlueXP à associer au connecteur.
.. Entrez un nom pour le système.
.. Sous *exécutez-vous dans un environnement sécurisé ?* maintenez le mode restreint désactivé.
+
Vous devez désactiver le mode restreint, car ces étapes décrivent l'utilisation de BlueXP en mode standard. Vous devez activer le mode restreint uniquement si vous disposez d'un environnement sécurisé et souhaitez déconnecter ce compte des services back-end BlueXP. Si c'est le cas, link:task-quick-start-restricted-mode.html["Suivez les étapes pour démarrer avec BlueXP en mode restreint"].

.. Cliquez sur *commençons*.




.Résultat
Le connecteur est maintenant installé et configuré avec votre compte BlueXP.

.Et la suite ?
link:task-provide-permissions-azure.html["Fournissez à BlueXP les autorisations que vous avez précédemment configurées"].

--
====